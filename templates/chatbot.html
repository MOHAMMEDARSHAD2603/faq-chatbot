<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FAQ Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #ece5dd;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #header {
      background:#075e54;
      color:#fff;
      padding:12px;
      text-align:center;
      font-weight:bold;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }
    #chatbox {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
      max-width: 100%;
      margin-top: 50px;
      padding-bottom: 80px; /* ensures content doesn't overlap footer */
      border-radius: 0;
      box-shadow: none;
      border: none;
      background: #fff;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      scroll-behavior: smooth;
      background: #fff;
    }
    .message { margin: 8px 0; padding: 10px; border-radius: 16px; max-width: 75%; word-wrap: break-word; }
    .user { background: #dcf8c6; margin-left: auto; text-align: right; }
    .bot { background: #f1f0f0; margin-right: auto; text-align: left; }
    .timestamp { font-size: 10px; color: #555; display: block; margin-top: 4px; }
    .category {
      font-size: 10px;
      color: #fff;
      border-radius: 10px;
      padding: 2px 6px;
      display: inline-block;
      margin-top: 4px;
      cursor: pointer;
    }
    .Booking { background: #4caf50; }
    .Orders { background: #ff9800; }
    .Payments { background: #2196f3; }
    .Cancellation { background: #9c27b0; }
    .Delivery { background: #f44336; }
    .Facilities { background: #795548; }
    .Offers { background: #009688; }
    .General { background: #607d8b; }
    #inputRow { display: flex; padding: 10px; border-top: 1px solid #ccc; background:#f1f1f1; }
    #question { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; font-size:16px; }
    button {
      margin-left: 8px;
      padding: 10px 16px;
      background: #25d366;
      color: #fff;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size:16px;
    }
    button:hover { background: #20b858; }
    #faqButton, #homeButton {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin: 5px 0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      display: block;
      color: #fff;
      box-sizing: border-box;
    }
    #faqButton { background: #007bff; }
    #faqButton:hover { background: #0056b3; }
    #homeButton { background: #6c757d; margin-bottom: 10px; }
    #homeButton:hover { background: #5a6268; }
    .feedback { margin-top: 6px; }
    .feedback button {
      margin: 2px;
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 12px;
      cursor: pointer;
      border: none;
    }
    .yesBtn { background: #4caf50; color: #fff; }
    .noBtn { background: #f44336; color: #fff; }
    .message.bot span[onclick] { transition: color 0.2s ease; }
    .message.bot span[onclick]:hover { color: #0056b3; }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #ece5dd;
      text-align: center;
      padding: 10px;
      font-size: 14px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="header">ü§ñ FAQ Chatbot Assistant</div>
  <div id="chatbox">
    <div id="messages"></div>
    <div id="inputRow">
      <input type="text" id="question" placeholder="Type a message..." />
      <button onclick="sendQuestion()">Send</button>
    </div>
    <button id="faqButton" onclick="showAllFAQs()">üìã View All FAQs</button>
    <button id="homeButton" onclick="resetChat()">üè† Home</button>
  </div>
  <footer>
    Built with ‚ù§Ô∏è by Mohammed Arshad | CodeAlpha Project
  </footer>

  <script>
    const API_URL = "/ask";
    const FAQ_URL = "/faqs";

    function addMessage(text, role, category = null, showFeedback = false) {
      const msg = document.createElement("div");
      msg.className = "message " + role;

      let categoryHTML = "";
      if (category) {
        let catClass = "General";
        if (category.includes("Booking")) catClass = "Booking";
        else if (category.includes("Order")) catClass = "Orders";
        else if (category.includes("Payment")) catClass = "Payments";
        else if (category.includes("Cancellation")) catClass = "Cancellation";
        else if (category.includes("Delivery")) catClass = "Delivery";
        else if (category.includes("Facility")) catClass = "Facilities";
        else if (category.includes("Offer")) catClass = "Offers";

        categoryHTML = `<span class="category ${catClass}" onclick="filterByCategory('${category}')">${category}</span>`;
      }

      msg.innerHTML = `
        ${text}
        <span class="timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
        ${categoryHTML}
      `;

      if (showFeedback) {
        const fbDiv = document.createElement("div");
        fbDiv.className = "feedback";
        fbDiv.innerHTML = `
          Was this helpful?
          <button class="yesBtn" onclick="sendFeedback('Yes', '${text}')">Yes</button>
          <button class="noBtn" onclick="sendFeedback('No', '${text}')">No</button>
        `;
        msg.appendChild(fbDiv);
      }

      document.getElementById("messages").appendChild(msg);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    }

    async function sendQuestion() {
      const input = document.getElementById("question");
      const question = input.value.trim();
      if (!question) return;
      addMessage(question, "user");
      input.value = "";

      try {
        showTyping();
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question })
        });
        const data = await res.json();
        hideTyping();
        addMessage(data.answer || "Sorry, I couldn't find an answer.", "bot", data.category, true);
      } catch (err) {
        hideTyping();
        addMessage("Error connecting to server.", "bot");
      }
    }

    async function filterByCategory(category) {
      try {
        const res = await fetch(`${FAQ_URL}?category=${encodeURIComponent(category)}`);
        const faqs = await res.json();
        addMessage(`üìÇ FAQs in category: ${category}`, "bot", category);
        faqs.forEach(faq => {
          addMessage(`üëâ ${faq.question}`, "bot", faq.category);
        });
      } catch (err) {
        addMessage("Error loading FAQs for category.", "bot");
      }
    }

    async function showAllFAQs() {
      try {
        const res = await fetch(FAQ_URL);
        const faqs = await res.json();
        addMessage("üìã Here are all available FAQs (click a question to see the answer):", "bot", "General");

                faqs.forEach(faq => {
          const msg = document.createElement("div");
          msg.className = "message bot";
          msg.innerHTML = `
            üëâ <span style="cursor:pointer; color:#007bff; text-decoration:underline;" 
                 onclick="sendFAQ('${faq.question}')">${faq.question}</span>
            <span class="timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
          `;
          document.getElementById("messages").appendChild(msg);
        });

        document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
      } catch (err) {
        addMessage("Error loading FAQs.", "bot");
      }
    }

    async function sendFAQ(question) {
      addMessage(question, "user");
      try {
        showTyping();
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question })
        });
        const data = await res.json();
        hideTyping();
        addMessage(data.answer || "Sorry, I couldn't find an answer.", "bot", data.category, true);
      } catch (err) {
        hideTyping();
        addMessage("Error connecting to server.", "bot");
      }
    }

    function resetChat() {
      const messages = document.getElementById("messages");
      messages.innerHTML = ""; // clear all messages
      addMessage(
        "üëã Hi, I‚Äôm your FAQ assistant. I can answer questions from our FAQ list. Click 'View All FAQs' to see them.",
        "bot",
        "General"
      );
    }

    // Handle feedback clicks
    function sendFeedback(response, answerText) {
      console.log("Feedback received:", response, "for answer:", answerText);
      addMessage(`‚úÖ Thanks for your feedback: "${response}"`, "bot", "General");

      // OPTIONAL: Send feedback to backend
      // fetch("/feedback", {
      //   method: "POST",
      //   headers: { "Content-Type": "application/json" },
      //   body: JSON.stringify({ feedback: response, answer: answerText })
      // })
      // .then(res => res.json())
      // .then(data => console.log("Feedback saved:", data))
      // .catch(err => console.error("Error saving feedback:", err));
    }

    // Typing indicator
    function showTyping() {
      const typing = document.createElement("div");
      typing.className = "message bot";
      typing.id = "typing";
      typing.innerHTML = "üí¨ Typing...";
      document.getElementById("messages").appendChild(typing);
    }

    function hideTyping() {
      const typing = document.getElementById("typing");
      if (typing) typing.remove();
    }

    // Allow pressing Enter to send
    document.getElementById("question").addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendQuestion();
    });

    // Welcome message
    window.onload = () => {
      addMessage(
        "üëã Hi, I‚Äôm your FAQ assistant. I can answer questions from our FAQ list. Click 'View All FAQs' to see them.",
        "bot",
        "General"
      );
    };
  </script>
</body>
</html>